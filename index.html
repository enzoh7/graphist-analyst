<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pro Analyst Terminal</title>
    <link rel="stylesheet" href="/src/style.css" />
</head>
<body>
    <div class="tv-header">
        <div class="tv-header-left">
            <select id="asset-select">
                <option value="XAUUSD" selected>XAU/USD </option>
                <option value="BTCUSDT">BTC/USDT</option>
                <option value="EURUSD">EUR/USD</option>
                <option value="GBPUSD">GBP/USD</option>
                <option value="USDJPY">USD/JPY</option>
            </select>
            <div id="tf-bar" class="timeframe-bar">
                <button class="tf-btn active" data-tf="1m">1m</button>
                <button class="tf-btn" data-tf="5m">5m</button>
                <button class="tf-btn" data-tf="15m">15m</button>
                <button class="tf-btn" data-tf="30m">30m</button>
                <button class="tf-btn" data-tf="1h">1h</button>
                <button class="tf-btn" data-tf="4h">4h</button>
                <button class="tf-btn" data-tf="1d">1d</button>
                <button class="tf-btn" data-tf="1w">1w</button>
                <button class="tf-btn" data-tf="1M">1M</button>
            </div>
        </div>
        <div id="auth-button-container" class="auth-button-container">
            <button id="auth-toggle-btn" class="auth-btn">üîê Connexion</button>
        </div>
    </div>

    <div class="trading-quick-buttons">
        <button id="quick-buy-btn" class="quick-btn buy-btn" title="Acheter directement (BUY)">
            üîº BUY
        </button>
        <button id="quick-config-btn" class="quick-btn config-btn" title="Configuration d'ordre avanc√©e">
            ‚öôÔ∏è
        </button>
        <button id="quick-sell-btn" class="quick-btn sell-btn" title="Vendre directement (SELL)">
            üîΩ SELL
        </button>
    </div>
    <div id="main-toolbar">
        <div class="tool-group">
            <button id="tool-cursor" class="tool-btn active">üìç Curseur</button>
            <button id="tool-hline" class="tool-btn">‚Äî Ligne Horiz</button>
            <button id="tool-rect" class="tool-btn">‚¨ú Rectangle</button>
            <button id="tool-fib" class="tool-btn">üìä Fibonacci</button>
        </div>
        <div class="tool-group">
            <button id="tool-position" class="tool-btn">üéØ Position</button>
        </div>
    </div>

    <div id="chart-container"></div>

    <div id="trading-panel" class="trading-panel">
        <div class="trading-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <h3>üéØ Ex√©cution d'Ordre</h3>
                
                <div class="account-switch-container">
                    <span id="label-demo" class="switch-label demo-label active">DEMO</span>
                    <label class="switch">
                        <input type="checkbox" id="account-type-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span id="label-real" class="switch-label real-label">REAL</span>
                </div>
            </div>

            <span id="server-status" class="server-status offline">‚óè D√©connect√©</span>
        </div>

        <form id="trade-form" class="trade-form">
            <div class="form-group">
                <label for="trade-symbol">Symbole</label>
                <select id="trade-symbol" required>
                    <option value="">S√©lectionnez un symbole</option>
                    <option value="XAUUSD" selected>XAU/USD (OR)</option>
                    <option value="BTCUSDT">BTC/USDT</option>
                    <option value="EURUSD">EUR/USD</option>
                    <option value="GBPUSD">GBP/USD</option>
                    <option value="USDJPY">USD/JPY</option>
                </select>
            </div>

            <div class="form-group">
                <label>Type d'Ordre</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="order-type" value="buy" checked required />
                        <span class="radio-buy">üîº BUY</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="order-type" value="sell" required />
                        <span class="radio-sell">üîΩ SELL</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="trade-volume">Volume (Lots)</label>
                <input type="number" id="trade-volume" min="0.01" step="0.01" value="0.01" required />
            </div>

            <div class="form-group">
                <label for="entry-price" style="display: flex; justify-content: space-between;">
                    <span>Prix d'Entr√©e (actuel)</span>
                    <span id="market-status" style="color: #ff9800; font-size: 10px; display: none; font-weight: 600;">‚è∏Ô∏è March√© inactif</span>
                </label>
                <input type="number" id="entry-price" step="0.00001" readonly placeholder="Auto" />
            </div>

            <div class="form-group">
                <label for="trade-tp">Take Profit (Prix)</label>
                <input type="number" id="trade-tp" step="0.00001" placeholder="Ex: 1.1050" />
            </div>

            <div class="form-group">
                <label for="trade-sl">Stop Loss (Prix)</label>
                <input type="number" id="trade-sl" step="0.00001" placeholder="Ex: 1.0950" />
            </div>

            <div class="form-group">
                <label for="risk-reward">Ratio R:R</label>
                <input type="text" id="risk-reward" readonly placeholder="Calcul√© automatiquement" />
            </div>

            <div class="trading-buttons">
                <button type="submit" id="trade-submit" class="btn-trade">üì§ Envoyer l'Ordre</button>
                <button type="reset" id="trade-reset" class="btn-secondary">üîÑ R√©initialiser</button>
            </div>

            <div id="order-status" class="order-status"></div>
        </form>
    </div>

    <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-overlay"></div>
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2>Pro Analyst Terminal</h2>
                <button id="auth-modal-close" class="auth-modal-close">‚úï</button>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab-btn active" data-tab="login">Connexion</button>
                <button class="auth-tab-btn" data-tab="signup">Inscription</button>
            </div>

            <div id="auth-tab-login" class="auth-tab-pane active">
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="votre.email@exemple.com" required />
                    </div>
                    <div class="form-group">
                        <label for="login-password">Mot de passe</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                            <button type="button" id="login-password-toggle" class="password-toggle-btn" title="Afficher/Masquer le mot de passe">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary full-width">üîê Connexion</button>
                    <div id="login-error" class="auth-error"></div>
                    <div id="login-loading" class="auth-loading"></div>
                </form>
            </div>

            <div id="auth-tab-signup" class="auth-tab-pane">
                <form id="signup-form" class="auth-form">
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" placeholder="votre.email@exemple.com" required />
                    </div>
                    <div class="form-group">
                        <label for="signup-username">Nom d'utilisateur (optionnel)</label>
                        <input type="text" id="signup-username" placeholder="votre_pseudo" />
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Mot de passe (min 8 caract√®res)</label>
                        <input type="password" id="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="8" required />
                    </div>
                    <div class="form-group">
                        <label for="signup-password-confirm">Confirmer le mot de passe</label>
                        <input type="password" id="signup-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="8" required />
                    </div>
                    <button type="submit" class="btn-primary full-width">‚úì Cr√©er un compte</button>
                    <div id="signup-error" class="auth-error"></div>
                    <div id="signup-loading" class="auth-loading"></div>
                </form>
            </div>

            <div id="auth-broker-section" class="auth-broker-section hidden">
                <div class="auth-section-divider">
                    <span>Configuration du Bridge Python</span>
                </div>
                <form id="broker-config-form" class="auth-form">
                    <div class="form-group">
                        <label for="bridge-url">URL du Bridge (localhost:5555)</label>
                        <input type="url" id="bridge-url" placeholder="tcp://127.0.0.1:5555" value="tcp://127.0.0.1:5555" readonly />
                    </div>
                    <div class="form-group" style="background: #f0f0f0; padding: 10px; border-radius: 4px;">
                        <p style="margin: 0; font-size: 12px; color: #666;">
                            <strong>‚ÑπÔ∏è Info:</strong> Le bridge Python utilise maintenant ZeroMQ sur le port 5555.
                            Les ordres seront ex√©cut√©es via ce bridge ultra-rapide.
                        </p>
                    </div>
                    <button type="submit" class="btn-secondary full-width" disabled>‚úì Configuration automatique</button>
                    <div id="broker-error" class="auth-error"></div>
                    <div id="broker-success" class="auth-success"></div>
                </form>

                <div class="auth-section-divider" style="margin-top: 24px;">
                    <span>Identifiants MT5 (Stockage S√©curis√©)</span>
                </div>
                <form id="mt5-credentials-form" class="auth-form">
                    <div class="credentials-grid">
                        <div class="cred-col">
                            <h4 style="margin: 0 0 12px 0; color: #2962ff; font-size: 13px; text-align: center;">üîµ Compte D√©mo</h4>
                            <div class="form-group"><input type="number" id="demo-login" placeholder="Login (ex: 12345)" /></div>
                            <div class="form-group"><input type="password" id="demo-password" placeholder="Mot de passe MT5" /></div>
                            <div class="form-group"><input type="text" id="demo-server" placeholder="Serveur (ex: MultiBank-Demo)" /></div>
                        </div>
                        <div class="cred-col">
                            <h4 style="margin: 0 0 12px 0; color: #26a69a; font-size: 13px; text-align: center;">üü¢ Compte R√©el</h4>
                            <div class="form-group"><input type="number" id="real-login" placeholder="Login (ex: 98765)" /></div>
                            <div class="form-group"><input type="password" id="real-password" placeholder="Mot de passe MT5" /></div>
                            <div class="form-group"><input type="text" id="real-server" placeholder="Serveur (ex: MultiBank-Live)" /></div>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary full-width" style="margin-top: 12px;">üíæ Sauvegarder les identifiants</button>
                    <div id="mt5-cred-status" class="auth-success" style="margin-top: 10px;"></div>
                </form>
            </div>

            <div id="auth-user-section" class="auth-user-section hidden">
                <div class="auth-user-info">
                    <p>Connect√© en tant que <strong id="auth-user-email"></strong></p>
                    <div id="broker-status-badge" class="broker-status-badge">
                        <div class="broker-status-header">
                            <span id="broker-status-indicator" class="broker-status-indicator offline">‚óè Serveur: D√©connect√©</span>
                            <span id="bridge-status-indicator" class="broker-status-indicator offline" style="margin-left: 15px;">‚óè Bridge: D√©connect√©</span>
                        </div>
                        <div id="broker-details-section" class="broker-details-section hidden">
                            <div class="broker-details">
                                <p><strong>üì± Serveur Node.js:</strong> <span id="server-port">localhost:3000</span></p>
                                <p><strong>üêç Bridge Python:</strong> <span id="bridge-port">tcp://127.0.0.1:5555</span></p>
                                <p><strong>‚ö° Statut Ordres:</strong> <span id="broker-connection-status" class="status-badge offline">Attente du bridge</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="auth-preferences">
                    <label class="checkbox-label">
                        <input type="checkbox" id="pref-economic-news" checked />
                        <span>Notifications des news √©conomiques</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="pref-explanations" checked />
                        <span>Afficher les explications des news</span>
                    </label>
                    <label>
                        <span>Th√®me</span>
                        <select id="pref-theme">
                            <option value="dark">Sombre</option>
                            <option value="light">Clair</option>
                        </select>
                    </label>
                </div>

                <button id="logout-btn" class="btn-danger full-width">üö™ D√©connexion</button>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
    <script src="/test.js" defer></script>
</body>
</html>